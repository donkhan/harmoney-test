<!DOCTYPE html>
<html>
<head>
<meta charset="ISO-8859-1">
<title>Documentation for MOOSE API Integration</title>
</head>
<body>
	<br><b><u> Preface </u></b><br><br>
		This document describes the REST End Points provided by Money Box Application for external applications to communicate. 
		To Execute REST call's, External application <u> must login </u> to Money Box using valid Login Credentials.
		We provide Test Programs for reference written in Java. External applications which are being developed using different programming languages can use these programs 
		as reference.In case they are written in Java, they can use these source code as it is. These test programs are available here <a href=https://github.com/donkhan/harmoney-test>Repository.</a></b> There is no URL available in MoneyBox to advertise all the End Points it is providing.
	    <br><br>
	
	<b><u> Please Note that Money Box is running in http now. </u></b> 
	<br><br>
	
	<b><u> Procedure to access the Money Box Resources </u></b><br>
	
	<ul>
  		<li>Login to Money Box using Valid login credentials </li>
  		<li>Grab the Session id received from the authentication call from HTTP Headers</li>
  		<li>For Every Subsequent Request to money box for resource access, add Session Id and X-UserId in the HTTP Headers</li>
  		<li>Logout once all operations are done.
	</ul>
	
	<b><u> Request Headers </u></b><br><br>
		The following parameters should be added to all the requests from the external application to MoneyBox
		<ul>
		 <li>Content-Type = application/json;charset=UTF-8 </li>
		 <li>User-Agent =STANDALONE_CODE </li>
		 <li>Accept = application/json </li>
		</ul> 
		<br>Except Login Request, all other requests should have the following additional headers.
		<ul>
		 <li>X-userId = User ID </li>
		 <li>Cookie = JSESSIONID= + {Session ID received from login request} </li>
		</ul>
		
	<br>
	<b><u> Login </u></b><br><br>
		URL : /harmoney2/sessionService/authenticate <br>
		HTTP Method: POST <br>
		Payload: {
				id: User Id, password : password
			}
		<br>
		<a href=https://github.com/donkhan/harmoney-test/blob/master/src/main/java/experiment/LoginTest.java> Test Program </a> <br>
		<u> How to extract Session ID from the request Headers </u>
		<ul>
			<li> Iterate over all http headers </li>
			<li> If header name is Set-Cookie, grab the value and retrieve session id. 
		</ul>
		<u>Sample HTTP Headers </u> <br>
		POST /harmoney2/sessionService/authenticate HTTP/1.1<br>
Host: localhost:8181<br>
Connection: keep-alive<br>
Content-Length: 28<br>
Accept: application/json, text/plain, */*<br>
X-UserId: null<br>
User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/47.0.2526.111 Safari/537.36<br>
Origin: http://localhost:8181<br>
Content-Type: application/json;charset=UTF-8<br>
DNT: 1<br>
Referer: http://localhost:8181/harmoney2/index<br>
Accept-Encoding: gzip, deflate<br>
Accept-Language: en-US,en;q=0.8<br>
<b>Cookie: JSESSIONID=534532C75EB9B38383D29D944E38AAE3</b>	
	<br><br><br>
	
	<b><u> Logout </u></b><br><br>
		URL : /harmoney2/sessionService/logout <br>
		HTTP Method: GET <br>
		Payload: None <br>
		<a href=https://github.com/donkhan/harmoney-test/blob/master/src/main/java/experiment/LogoutTest.java> Test Program </a> <br>
	<br> 
	
	<b> <u>Getting Stocks for given Branch and Currency </u> </b> <br> <br> 
	URL : /harmoney2/get-stocks/{branch-name}/{currency} <br>
	 HTTP Method: GET <br>
	 Payload: None <br>
	 Sample Output : <br> 
        "data":{ "branchStocks": 120, "tellersStocks" : 1221, code : 0, description : "Success" } <br>
	 Error Code(s) : <br> 
		ALL_FINE = 0, <br>
		BRANCH_NOT_FOUND = 1 <br>
		CURRENCY_NOT_FOUND = 2<br>
		
	Example : /harmoney2/get-stocks/Trichy/USD  <br>
	<a href=https://github.com/donkhan/harmoney-test/blob/master/src/main/java/experiment/MooseTestProgram.java> Test Program </a> 
	<br><br>
	
	<b> <u>Executing Transactions in MoneyBox from Moose </u> </b> <br> <br> 
	URL : /harmoney2/harmoney2/moose-transaction/{branch-name} <br>
	 HTTP Method: POST <br>
	 Payload:  { "transactions" : [{"exchangeRate" : double,"currencyId": double, "exchangeUnit" : double }...]<br>
	 Example : PayLoad {"transactions":[{"exchangeRate":3,"currencyId":"USD","exchangeUnit":10},{"exchangeRate":5,"currencyId":"GBP","exchangeUnit":10}]}
	 <br>
	 Sample Output : <br> 
	    {"code":0,"description":"Transaction(s) executed successfully... ...","data":{"receiptId":36,"transactions":[{"exchangeRate":3.0,"exchangeUnit":10.0,"currencyId":"USD","id":22},{"exchangeRate":5.0,"exchangeUnit":10.0,"currencyId":"GBP","id":23}]}}
	 <br>   	    
	 Error Code(s) : <br> 
		ALL_FINE = 0, <br>
		BRANCH_NOT_FOUND = 1 <br>
		CURRENCY_NOT_FOUND = 2<br>
		TRANSACTIONS_MISSING = 3<br>
		DEALER_NOT_FOUND = 4<br>
		ACCOUNT_NOT_FOUND = 5<br>
		ORDER_CREATION_FAILED = 6<br>
		UNKNOWN_ERROR = 7<br>
		INVALID_INPUT = 8<br>
		INSUFFICIENT_STOCKS = 8<br>
	
	<a href=https://github.com/donkhan/harmoney-test/blob/master/src/main/java/experiment/MooseTransactionTest.java> Test Program </a> 
	<br><br>
	
	<b> <u>Things to care </u> </b> <br> 
		<ul> 
			<li> Please Make sure to logout. </li>
			<li> In case session timesout, user will be locked and it needs administrator intervention to unlock the user id.
			<li> Multiple failed logins will result in account being locked.
		</ul>
</body>
</html>